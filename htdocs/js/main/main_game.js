enchant();
var character;
var map;
window.onload = function() {
  var x = window.innerWidth / 100 * 35;
  var y = window.innerHeight / 100 * 35;
  // console.log(x + ":" + y);
  var game = new Core(512, 512);


  var charaImage  = "/src/character.png";
  var mapImage    = "/apis/enchant.js/images/map.png";
  game.preload(charaImage, mapImage);

  game.onload = function(){
    // マップ====================================================
    map = new Map(32, 32);
    map.image = game.assets[mapImage];
    map.loadData([
        [33,49,49,49,49,49,49,49,49,49,49,49,49,49,49,33],
        [34,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32],
        [34,20,20,100,100,100,100,100,100,100,100,100,100,100,20,32],
        [34,20,20,20,20,20,20,20,20,20,20,20,20,100,20,32],
        [34,20,20,20,20,100,100,100,100,100,100,100,20,100,20,32],
        [34,20,20,20,20,100,20,20,20,20,20,100,20,100,20,32],
        [34,20,20,20,20,100,20,20,20,20,20,100,20,100,20,32],
        [34,20,20,20,20,100,20,20,27,100,100,100,20,100,20,32],
        [34,20,20,20,20,100,20,20,20,20,20,20,20,100,20,32],
        [34,20,20,20,20,100,20,20,20,20,20,20,20,100,20,32],
        [34,20,20,20,20,100,100,100,100,100,100,100,100,100,20,32],
        [34,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32],
        [34,20,20,20,20,20,20,20,20,20,20,20,20,20,20,32],
        [33,17,17,17,17,17,17,17,17,17,17,17,17,17,17,33],
        [33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33],
        [33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33]
    ],[
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,60,61,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,76,77,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
        [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]
    ]);
    map.collisionData = [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],
        [1,1,1,1,1,0,0,0,0,0,0,0,1,0,1,1],
        [1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1],
        [1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1],
        [1,1,1,1,1,0,1,1,0,0,0,0,1,0,1,1],
        [1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1],
        [1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1],
        [1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ];


    game.rootScene.addChild(map);
    //==========================================================

    var sprite = new Sprite(x, x);
    sprite.x = 0;
    sprite.y = 0;
    var surface = new Surface(x, x);
    sprite.image = surface;
    var ctx = surface.context;
    ctx.strokeStyle = "rgb(0, 0, 0)";
    ctx.strokeRect(0, 0, x , x);
    ctx.stroke();


    character = new Sprite(32, 32);
    character.image = game.assets[charaImage];
    character.x = 3 * 32;
    character.y = 2 * 32;
    // character.scaleX = 0.5;
    // character.scaleY = 0.5;
    character.animeWaitMax = 3;
    character.animeWaitCount = 0;

    character.direction = 1; //初期向き
    character.frame = character.direction * 3;

    game.rootScene.addChild(character);
    // game.rootScene.addChild(sprite);

    game.scale = x / 512;
    // console.log(game.width / 12);
  };

  game.start();
  window.scrollTo(0, 0);
};
